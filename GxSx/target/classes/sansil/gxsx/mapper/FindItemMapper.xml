<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	<mapper namespace="sansil.gxsx.mapper.FindItemMapper">
	
	
	<select id="selectFinditem" resultType="FindItem">
		select * from FINDITEM where FIUID = 'cclubley3'
	</select>	
	
	<select id="selectByWriter" resultType="FindItem" parameterType="FindListVo">
		<![CDATA[
 		select * from (select ROWNUM rnum, aa.* from (select * from FINDITEM where WRITER like '%'||#{keyword}||'%' order by FINO desc)aa)
 		where rnum>#{startRow} and rnum<=#{endRow} 
		]]>
	</select>
	
	<insert id="insert" parameterType="FindItem">
		insert into FindItem values(FINDITEM_SEQ_PK.nextval, #{fiuid}, #{fisub}, #{ficon}, SYSDATE, #{fiano}, #{fiplace}, #{fistor}, #{ficname}, #{fifin})
	</insert>
	
	<insert id="insertBoard" parameterType="FindItem">
		<selectKey keyProperty="fino" resultType="int" order="BEFORE">
			select FINDITEM_SEQ_PK.nextval from DUAL
		</selectKey>
		INSERT INTO FINDITEM 
		(	
			FINO,
			FIUID,
			FISUB,
			FICON,
			FIDATE,
			FIANO,
			FIPLACE,
			FISTOR,
			FICNAME,
			FIFIN
			
		) VALUES (
			#{fino},
			#{fiuid},
			#{fisub},
			#{ficon},
			SYSDATE,
			#{fiano},
			#{fiplace},
			#{fistor},
			#{ficname},
			0
		)
		
	</insert>
	
	<insert id="insertBoardPic" parameterType="java.util.Map">
		INSERT INTO FINDPIC 
		(	
			FIPICNO,
			FIPNO,
			FIPICNAME
			
		) VALUES (
			FINDPIC_SEQ_PK.nextval,
			#{fipno},
			#{fipicname}
		)
	</insert>
	
	<update id="update" parameterType="FindItem">
		update FindItem set FICNAME=#{ficname}, FISUB=#{fisub}, FICON=#{ficon}, FIANO=#{fiano}, FIPLACE=#{fiplace}, FIFIN=#{fifin} where FINO=#{fino}
	</update>
	
	<delete id="delete" parameterType="long">
		delete from FINDITEM where FINO=#{fino}
	</delete>
	
	<!-- ////////////////////////////////////////// -->
	<select id="selectByName" resultType="FindItPic" parameterType="String">
	     select * from FINDITEM join FINDPIC on finditem.fino = findpic.fipno join area on finditem.fiano = area.ano
		 where finditem.FISUB like '%'||#{fisub}||'%' order by FINO desc
	</select>
	
	<select id="selectCount" resultType="long">
		select COUNT(FINO) from FINDITEM
	</select>
	
	<select id="selectCount2" resultType="long" parameterType="String">
		select COUNT(FINO) from FINDITEM where FISUB like '%'||#{fisub}||'%' order by FINO desc
	</select>
	
<!-- 	<select id="selectPerPage" resultType="FindItPic" parameterType="FindListVo"> -->
<!-- 		<![CDATA[ -->
<!--  		select * from (select ROWNUM rnum, aa.* from (select * from finditem left outer join findpic on   -->
<!--  		finditem.fino = findpic.fipno join area on finditem.fiano = area.ano order by FINO desc)aa)  -->
<!--  		where rnum>#{startRow} and rnum<=#{endRow}  -->
<!--  		]]> -->
<!-- 	</select> -->
	
	<select id="selectCountFinditem" resultType="Long">
		select count(*) from FINDITEM
	</select>
	
	<select id="selectPerPage" resultType="FindItPic" parameterType="Pagination">
<!-- 		<![CDATA[
		select * from (select ROWNUM rnum, aa.* from (select * from finditem join findpic on finditem.fino = findpic.fipno join area on finditem.fiano = area.ano
		 order by FINO desc) aa) where rnum between #{startRow} and #{endRow}
		]]> -->
		
		select * from (select aa.*, ROWNUM rnum from (
    	select finditem.fisub, finditem.fiuid , finditem.fino , finditem.fidate , finditem.ficon , finditem.fiano , finditem.fiplace , finditem.ficname , finditem.fifin , 
		(select fipicname from findpic where findpic.fipno = finditem.fino AND ROWNUM= 1) as fipicname
  		from finditem left join findpic on finditem.fino = findpic.fipno GROUP BY finditem.fino , finditem.fisub, finditem.fiuid , finditem.fino , finditem.fidate , finditem.ficon , finditem.fiano , finditem.fiplace , finditem.ficname , finditem.fifin)
    	aa) where rnum between #{startRow} and #{endRow}
	</select>
	
	<select id="selectPerPage2" resultType="FindItPic" parameterType="FindListVo">
		<![CDATA[
		select * from (select ROWNUM rnum, aa.* from (select * from finditem left outer join findpic on 
		finditem.fino = findpic.fipno join area on finditem.fiano = area.ano where fisub like '%'||#{keyword}||'%' order by FINO desc)aa)
		where rnum>#{startRow} and rnum<=#{endRow}
		]]>
	</select>
	
	<select id="selectBySeq" resultType="FindItPic" parameterType="long">
		select it.fino, it.fiuid, it.fisub, it.ficon, it.fidate, it.fiano, it.fiplace, it.fistor, it.ficname, it.fifin, pic.fipicname from finditem it left outer join findpic pic on it.fino = pic.fipno where it.fino = #{fino}
	</select>
	
	<select id="area" resultType="String" parameterType="long">
		select acity from area where ano=(select fiano from findItem where fino=#{fino})
	</select>
		
	<select id="getFindRelated" resultType="FindItPic">
		<![CDATA[
		select * from (select ROWNUM rnum, aa.* from (select * from finditem left outer join findpic on 
		finditem.fino = findpic.fipno join area on finditem.fiano = area.ano order by FINO desc)aa)
		where ROWNUM <=8
		]]>	
	</select>
	
	<!-- /////////////////////////////////////코멘트 -->
	<select id="FindCommentList" resultType="FiComments" parameterType="int">
		select * from FICOMMENTS where FINO = #{fino} order by COGROUP, CODATE
	</select>
	
</mapper>